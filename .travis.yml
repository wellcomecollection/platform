language: sh

sudo: required

services:
  - docker

dist: trusty

branches:
  only:
    - master

script:
  # Wait 45 minutes for the entire build to finish.
  - travis_wait 45 ./run_travis.sh

jobs:
  include:
    - stage: preflight
      env: TASK=travis-format

    - stage: shared_lambdas
      env: TASK=dynamo_write_heartbeat-test
    - env: TASK=drain_ecs_container_instance-test
    - env: TASK=ecs_ec2_instance_tagger-test
    
    - stage: reporting
      env: TASK=reporting_miro_transformer
    - env: TASK=reporting_miro_inventory_transformer
    - env: TASK=reporting_sierra_transformer
    - env: TASK=reporting_calm_transformer
#    - stage: nginx
#      env: TASK=nginx-build

#    - stage: loris
#      env: TASK=loris-build
#    - env: TASK=cache_cleaner-build



stages:
  - quicktest
  - test
