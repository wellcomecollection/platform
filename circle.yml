machine:
  timezone: UTC

general:
  build_dir: terraform
  artifacts:
    - terraform.plan

dependencies:
  pre:
    - ./tf_init.sh $INFRA_BUCKET

test:
  override:
    - ./tf_plan.sh $KEY_NAME $ADMIN_CIDR $CONTAINER_URL $INFRA_BUCKET $CIRCLE_SHA1

deployment:
  production:
    branch: master
    commands:
      - ./terraform apply terraform.plan
      - ./terraform remote push
