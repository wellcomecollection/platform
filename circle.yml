machine:
  timezone: UTC
  services:
    - docker

general:
  build_dir: terraform
  artifacts:
    - terraform.plan

dependencies:
  pre:
    - pip install awscli
    - ./tf_init.sh $INFRA_BUCKET

test:
  override:
    - ./tf_plan.sh $KEY_NAME $ADMIN_CIDR

deployment:
  production:
    branch: master
    commands:
      - aws s3 cp terraform.plan s3://$INFRA_BUCKET/plans/$CIRCLE_SHA1/terraform.plan
