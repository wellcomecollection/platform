machine:
  timezone: UTC

general:
  build_dir: terraform
  artifacts:
    - terraform.plan

dependencies:
  pre:
    - ./tf_init.sh

test:
  override:
    - ./terraform plan --var "key_name=$KEY_NAME" --var "admin_cidr_ingress=$ADMIN_CIDR" -out=terraform.plan

deployment:
  production:
    branch: master
    commands:
      - ./terraform apply terraform.plan
      - ./terraform remote push
